<!DOCTYPE html>
    <html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Api ABC Indústria</title>
    </head>
    <body>
    <h5>Lista de máquinas</h5>
    <ul id="maquinas"></ul>
    <hr>
    <h5>Nova máquina</h5>
    <input type="text" name="name" id="name" placeholder="Nome"><br>
    <input type="text" name="status" id="status" placeholder="Status"><br>   
    <button type="button" onclick="createMaquina()">Cadastrar máquina</button>
    <hr>
    <h4>Editar Máquina</h4>
    <input type="text" name="idEdit" id="idEdit" placeholder="ID" readonly><br>
    <input type="name" name="nameEdit" id="nameEdit" placeholder="Nome"><br>
    <input type="status" name="statusEdit" id="statusEdit" placeholder="Status"><br>   
    <button type="button" onclick="updateMaquina()">Editar</button>

</body>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    function createMaquina(){
    var nameInput = document.getElementById("name");
    var statusInput = document.getElementById("status");
    
    var maquina = {
        name: nameInput.value,
        status: statusInput.value     
    }
        axios.post("http://localhost:8087/maquina", maquina).then(response => {
        if(response.status == 200){
            alert("Máquina cadastrada!")
            }
        }).catch(err => {
            console.log(err);
        });
    }

    function deleteMaquina(listItem){
        var id = listItem.getAttribute("data-id");
        axios.delete("http://localhost:8087/maquina/"+id).then(response => {
            alert("Máquina deletada!")
        }).catch(err => {
            console.log(err);
        });
    }

    function loadForm(listItem){
        var id = listItem.getAttribute("data-id");
        var name = listItem.getAttribute("data-name");
        var status = listItem.getAttribute("data-status");
        document.getElementById("idEdit").value = id;
        document.getElementById("nameEdit").value = name;
        document.getElementById("statusEdit").value = status;
       
    }

    function updateMaquina(){
        var idInput = document.getElementById("idEdit");
        var nameInput = document.getElementById("nameEdit");
        var statusInput = document.getElementById("statusEdit");

    var maquina = {
        name: nameInput.value,
        status: statusInput.value,
        
    }

    var id = idInput.value;

    axios.put("http://localhost:8087/maquina/"+id, maquina).then(response => {
        if(response.status == 200){
            alert("Máquina atualizada!")
            }
        }).catch(err => {
            console.log(err);
        });
    }

    axios.get("http://localhost:8087/maquinas").then(response => {
        var maquinas = response.data;
        var list = document.getElementById("maquinas");

        maquinas.forEach(maquina => {
            var item = document.createElement("li");

            item.setAttribute("data-id", maquina.id);
            item.setAttribute("data-name", maquina.name);
            item.setAttribute("data-status", maquina.status);

            item.innerHTML = `Máquina: ${maquina.name} - Status: ${maquina.status}`;

            var deleteBtn = document.createElement("Button");
            deleteBtn.innerHTML = "Deletar";

            deleteBtn.addEventListener("click", function(){
                deleteMaquina(item)
            })

            var editBtn = document.createElement("button");
            editBtn.innerHTML = "Editar";
            editBtn.addEventListener("click", function(){
                loadForm(item);
            });

            item.appendChild(deleteBtn);
            item.appendChild(editBtn);
            list.appendChild(item);
        });
    }).catch(error => {
        console.log(error);
    })
</script>
</html>